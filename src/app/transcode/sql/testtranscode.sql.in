DELIMITER $$

/* HARDWARE SETUP */

-- create host
SET @hostname = 'testserver';$$
SET @hostguid = null;$$
call klk_host_get_uuid(@hostname, @hostguid);$$

-- create host (external)
SET @hostname_ext = 'external testserver';$$
SET @hostguid_ext = null;$$
call klk_host_get_uuid(@hostname_ext, @hostguid_ext);$$
-- create bus
SET @description = 'pci bus #1';$$
SET @id = 1;$$
SET @bus_type_id = 'f52a9046-be9c-102b-92d7-001d093d7c53';$$
call klk_bus_add(@hostguid, @id, @description, @bus_type_id, @busguid, 
		@result); $$

-- create network card
SET @trunk = '@NETWORK_TRUNK_DEFAULT@';$$
SET @node_name = '@NETDEV_DEFAULT@';
SET @enabled = 1;
SET @resource_name = @node_name;
CALL klk_network_interface_resource_add(@busguid, @trunk, @enabled, 
		@node_name, @resource_name, @nwresourceguid, @result);$$

SET @address = NULL;$$
SET @ipaddress = '127.0.0.1';$$
SET @ipmask = '255.0.0.0';$$
CALL klk_network_interface_address_add(@address, @nwresourceguid, @ipaddress,
		@ipmask, @result);$$


/* APPLICATION SETUP */

-- create transcode demo application
SET @application = '@TRANSCODE_TESTAPPLICATION@' ;$$
SET @module = '@MODULE_TRANS_ID@' ;$$
SET @app_name = 'transcode@testserver';$$
SET @enabled = 1;$$
SET @status = 0;$$
SET @priority = 0;$$
SET @description = 'transcode server';$$
CALL klk_application_add(@application, @module, @app_name, @enabled, @status,
		@priority, @hostguid, @description, @return_value);$$ 

-- create transcode demo application on external server
SET @application_ext = '9eb8123a-ace7-4131-86c7-54ad1d33a185' ;$$
SET @app_name = 'transcode@external testserver';$$
CALL klk_application_add(@application_ext, @module, @app_name, 
     @enabled, @status, @priority, @hostguid_ext, 
     @description, @return_value);$$ 


-- create main application data --

-- test input data from an avi file
SET @input_file_uuid='@TRANSCODE_TESTINPUTFILE_UUID@';$$
call klk_file_add(@input_file_uuid, '@TRANSCODE_TESTINPUTFILE_NAME@',
     '@TRANSCODE_TESTINPUTFILE_PATH@', @hostguid, 
	 '@FILE_TYPE_REGULAR_UUID@', @return_value);$$


SET @input_source_uuid = @input_file_uuid;$$
SET @input_source_name = '@TRANSCODE_TESTINPUTSOURCE_NAME@';$$
SET @input_media_type = '@MEDIA_TYPE_AUTO@';$$
SET @input_source_type = '@MODULE_TRANS_SOURCE_TYPE_FILE_UUID@';$$
call klk_app_transcode_source_add(@input_source_uuid, @input_source_name,
 @input_media_type, @input_source_type, @return_value);$$

-- test output data to an avi file
SET @output_file_uuid='@TRANSCODE_TESTOUTPUTFILE_UUID@';$$
call klk_file_add(@output_file_uuid, '@TRANSCODE_TESTOUTPUTFILE_NAME@',
     '@TRANSCODE_TESTOUTPUTFILE_PATH@', @hostguid,
	 '@FILE_TYPE_REGULAR_UUID@',  @return_value);$$

SET @output_source_uuid = @output_file_uuid;$$
SET @output_source_name = '@TRANSCODE_TESTOUTPUTSOURCE_NAME@';$$
SET @output_media_type = '@MEDIA_TYPE_AUTO@';$$
SET @output_source_type = '@MODULE_TRANS_SOURCE_TYPE_FILE_UUID@';$$
call klk_app_transcode_source_add(@output_source_uuid, @output_source_name,
 @output_media_type, @output_source_type, @return_value);$$

-- test network stream to a specified route via flv
SET @proto = '@NETWORK_PROTO_TCPIP@';$$
SET @route = '@TRANSCODE_TESTROUTE_UUID@';$$
SET @name = '@TRANSCODE_TESTROUTE_NAME@';$$
SET @host = '@TRANSCODE_TESTROUTE_ADDR@';$$
SET @port = @TRANSCODE_TESTROUTE_PORT@;$$
CALL klk_network_route_add(@route, @name, 
     @address, @host, @port, @proto, @result);$$

SET @route_source_uuid = @route;$$
SET @route_source_name = '@TRANSCODE_TESTROUTESOURCE_NAME@';$$
SET @route_media_type = '@MEDIA_TYPE_FLV@';$$
SET @route_source_type = '@MODULE_TRANS_SOURCE_TYPE_NET_UUID@';$$
call klk_app_transcode_source_add(@route_source_uuid, @route_source_name,
 @route_media_type, @route_source_type, @return_value);$$

-- Now we add two tasks
SET @task1_uuid = '@TRANSCODE_TESTTASK1_UUID@';$$
SET @task1_name = '@TRANSCODE_TESTTASK1_NAME@';$$
SET @task1_vsize = '@MODULE_TRANS_VSIZE_DEFAULT_UUID@';$$
SET @task1_vquality = '@MODULE_TRANS_VQUALITY_DEFAULT_UUID@';$$
SET @task1_schedule = '@MODULE_TRANS_SCHEDULE_REBOOT@';$$
call klk_app_transcode_task_add(@task1_uuid, @task1_name, @input_source_uuid,
     @output_source_uuid, 
 	 @task1_vsize, @task1_vquality, 		 
	 @task1_schedule, 0, @return_value);$$

SET @task2_uuid = '@TRANSCODE_TESTTASK2_UUID@';$$
SET @task2_name = '@TRANSCODE_TESTTASK2_NAME@';$$
SET @task2_media_type = '@MEDIA_TYPE_FLV@';$$
SET @task2_vsize = '@MODULE_TRANS_VSIZE_DEFAULT_UUID@';$$
SET @task2_vquality = '@MODULE_TRANS_VQUALITY_DEFAULT_UUID@';$$
SET @task2_schedule = '@MODULE_TRANS_SCHEDULE_REBOOT@';$$
call klk_app_transcode_task_add(@task2_uuid, @task2_name, @input_source_uuid,
     @route_source_uuid,  
	 @task2_vsize, @task2_vquality, 
	 @task2_schedule, 0, @return_value);$$

-- FIXME!!! add future test for ticket #181
-- SET @task3_uuid = NULL;$$
-- SET @task3_name = 'task_external';$$
-- SET @task3_media_type = '@MEDIA_TYPE_FLV@';$$
-- call klk_app_transcode_task_add(@task3_uuid, @task3_name, @output_source_uuid,
--      @input_source_uuid, @task3_media_type, @return_value);$$

DELIMITER ;
